<template>
  <div class="paymentbody--form">
    <div class="paymentbody--list" v-if="promoCodes !== null && promoCodes.length !== 0">
      <div class="promocodestitle main-header">
        Valid Promo Codes
      </div>
      <div class="promocodeinfo" v-for="(promocode, index) in promoCodes" :key="index" :class="{ 'last-item': index === Object.keys(promoCodes).length - 1 }">
        <div class="promocodestitle promocode-sub-header">{{ promocode.couponName }}</div>
        <div v-if="promocode.couponCodeType === 1" class="promocode-value">{{promocode.currency }} {{ promocode.couponBalance }}</div>
        <div v-else class="promocode-value">{{ promocode.couponBalance * 100 }}% OFF (Max. {{ promocode.currency }} {{ formatNumber(promocode.maxDiscountAmount) }})</div>
        <div class="promocode-date" :class="{ 'to-expire' : formatExpiryDate(promocode.couponEndDate).status === 'red' } ">Expiry: {{ formatExpiryDate(promocode.couponEndDate).expiryDate }}</div>
      </div>
    </div>
    <div class="paymentbody--input-wrap">
      <input
        v-model="promocode_payment_data.sendy_coupon"
        type="text"
        name="sendy_coupon"
        placeholder="Promo Code"
        class="input-control paymentbody--input"
      >
    </div>
    <div class="paymentbody--input-wrap">
      <button
        type="button"
        name="button"
        :disabled="processing || !valid_payment"
        class="button-primary paymentbody--input-button"
        :class="{ 'paymentbody--input-button button--primary-inactive' : !valid_payment || processing }"
        @click="redeem_coupon"
      >
        Redeem
         <i
          v-if="processing"
          class="el-icon-loading tracking-loading-spinner promocode-spinner"
        />
      </button>
    </div>
  </div>
</template>

<script>
import { mapActions } from 'vuex';
import NotificationMxn from '../../../mixins/notification_mixin';
import TimezoneMxn from '../../../mixins/timezone_mixin';
import promocodesMxn from '../../../mixins/promocodes_mixin';


export default {
  mixins: [NotificationMxn, TimezoneMxn, promocodesMxn],
  data() {
    return {
      promocode_payment_data: {
        sendy_coupon: '',
      },
    };
  },
  computed: {
    valid_payment() {
      return this.promocode_payment_data.sendy_coupon !== '';
    },
  },
  watch: {
    promoCodes(data) {
      this.promoCodes = data;
    },
    notification (obj) {
          this.displayNotification(obj);
      },
  },
   mounted() {
     this.requestPromoCodes();

  },
  methods: {
    ...mapActions(['$_payment/requestPromoCodePayment']),
  
      redeem_coupon() {
            this.requestPromoPayment(this.promocode_payment_data.sendy_coupon);
        },
  },
};
</script>

<style lang="css">
.promocodestitle{
    font-size: 16px;
    line-height: 28px;
    letter-spacing: 0.02em;
    color: #000000;
}
.promocodeinfo {
  padding: 8px 0;
    border-bottom: 0.4px solid #DCDFE6;
}
.main-header {
  font-weight: 500;
}
.promocode-sub-header {
    color: #303133;
}
.promocode-value {
  font-weight: 500;
  font-size: 12px;
  line-height: 16px;
  letter-spacing: 0.4px;
  color: #909399;
}
.promocode-date {
  font-size: 11px;
  line-height: 18px;
  color: #6EC763;
}
.to-expire {
  color: #F7797F;
}
.paymentbody--form {
  margin-left: 2em;
}
.paymentbody--list {
  margin: .5em;
}
.promocode-spinner {
  font-size: 15px !important;
  font-weight: 700;
  color: #fff !important;
}
.last-item {
    border-bottom: none;
}
</style>
