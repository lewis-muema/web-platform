image: node

stages:
  # also create a tests stage
  - test
  - lint
  - buildfeaturebranch
  - deployforqa

# Lets name our Job eslint, because that's what it's doing.
eslint:
  # tell eslint what stage it is. (This could also be build or test for example)
  stage: lint
  tags:
    - docker

  # What scripts do we want to run?
  script:
    # install eslint
    - npm i eslint
    # Run eslint
    - npm run lint

# Lets name our Job unitTest, because that's what it's doing.
unitTest:
  # tell eslint what stage it is. (This could also be build or test for example)
  stage: test
  tags:
    - docker

  # What scripts do we want to run?
  script:
    # install mocha-webpack
    - npm i mocha-webpack
    # Run tests
    - npm run test

variables:
  FEATURE_BRANCH: sendy-docker-local.jfrog.io/vue-webplatform-$CI_COMMIT_BRANCH:latest

buildpushfeaturebranch:
  tags:
    - qa-ready
  stage: buildfeaturebranch
  script: 
    - docker build --pull -t $FEATURE_BRANCH -f Dockerfile . 
    - docker push $FEATURE_BRANCH

deployfor-qa-tests:
  tags:
    - qa-ready
  stage: deployforqa
  script:
    - ssh -v -f -o StrictHostKeyChecking=no -l admin kubetest-master.sendyit.com "kubectl set image deploy vue-web-platform  vue-web-platform=$FEATURE_BRANCH"
